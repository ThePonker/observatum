Text File Summary:
- First lines:
"""
Filter Panel Widget for Observatum
Filtering controls for Data tab records view

Allows filtering by:
- Date range
- Species
- Site
- Recorder
- Text search
"""

import tkinter as tk
from tkinter import ttk
from datetime import datetime, timedelta
from typing import Callable, Dict, Optional
import logging

logger = logging.getLogger(__name__)


class FilterPanel(ttk.LabelFrame):
    """Filter panel widget for records"""
    
    def __init__(self, parent, on_filter_changed: Callable, **kwargs):
        """
        Initialize filter panel
        
        Args:
            parent: Parent widget

- Last lines:
        # Update species
        self.species_combo['values'] = ["All Species"] + sorted(species_list)
        
        # Update sites
        self.site_combo['values'] = ["All Sites"] + sorted(site_list)
        
        # Update recorders
        self.recorder_combo['values'] = ["All Recorders"] + sorted(recorder_list)
    
    def update_count(self, count: int):
        """
        Update the record count label
        
        Args:
            count: Number of records
        """
        self.count_label.config(text=f"{count:,} record{'s' if count != 1 else ''}")
    
    def _on_filter_change(self):
        """Called when any filter changes"""
        # Debounce search input (wait a bit before filtering)
        if hasattr(self, '_filter_timer'):
            self.after_cancel(self._filter_timer)
        
        self._filter_timer = self.after(300, self._apply_filters)
    
    def _apply_filters(self):
        """Apply filters and call callback"""
        filters = self.get_filters()
        self.on_filter_changed(filters)
